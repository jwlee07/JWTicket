{% extends 'review/base.html' %}
{% load static %}

{% block title %}{{ concert.name }} - 공연 상세{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- 공연 상세 정보 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <h1 class="display-6 fw-bold mb-3">{{ selected_concert.name }}</h1>
                    <div class="d-flex flex-wrap gap-4">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-geo-alt-fill text-primary me-2"></i>
                            <span class="text-gray-700 fw-medium">{{ selected_concert.place }}</span>
                        </div>
                        {% if selected_concert.genre %}
                        <div class="d-flex align-items-center">
                            <i class="bi bi-tag-fill text-primary me-2"></i>
                            <span class="text-gray-700 fw-medium">{{ selected_concert.genre }}</span>
                        </div>
                        {% endif %}
                        {% if selected_concert.date %}
                        <div class="d-flex align-items-center">
                            <i class="bi bi-calendar-event-fill text-primary me-2"></i>
                            <span class="text-gray-700 fw-medium">{{ selected_concert.date }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 리뷰 평점 분석 카드 -->
    <div class="row g-4 mb-5">
                <!-- 전체 공연 리뷰 평균 평점 카드 -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm hover-card">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h5 class="card-title fw-bold mb-0 text-gray-800">전체 공연 리뷰 평점</h5>
                    </div>
                    <div class="text-center mb-4">
                        <div class="display-4 fw-bold text-primary mb-1">{{ overall_avg|floatformat:1|default:"0.0" }}</div>
                        <div class="text-gray-500 small fw-medium">/10점</div>
                            </div>
                    <div class="progress rounded-pill mb-3" style="height: 8px;">
                                <div class="progress-bar bg-primary" role="progressbar" 
                                     style="width: {% widthratio overall_avg|default:0 10 100 %}%;" 
                                     aria-valuenow="{{ overall_avg|floatformat:1|default:'0' }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="10">
                                </div>
                            </div>
                    <div class="d-flex align-items-center justify-content-center">
                        <span class="text-gray-600">총 <span class="fw-bold text-gray-800">{{ overall_count|default:"0" }}</span>건의 리뷰</span>
                    </div>
                        </div>
                    </div>
                </div>
                
                <!-- 해당 장르 리뷰 평균 평점 카드 -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm hover-card">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h5 class="card-title fw-bold mb-0 text-gray-800">해당 장르 리뷰 평점</h5>
                    </div>
                    <div class="text-center mb-4">
                        <div class="display-4 fw-bold text-info mb-1">{{ genre_avg|floatformat:1|default:"0.0" }}</div>
                        <div class="text-gray-500 small fw-medium">/10점</div>
                            </div>
                    <div class="progress rounded-pill mb-3" style="height: 8px;">
                                <div class="progress-bar bg-info" role="progressbar" 
                                     style="width: {% widthratio genre_avg|default:0 10 100 %}%;" 
                                     aria-valuenow="{{ genre_avg|floatformat:1|default:'0' }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="10">
                                </div>
                            </div>
                    <div class="d-flex align-items-center justify-content-center">
                        <span class="text-gray-600">장르 <span class="fw-bold text-gray-800">{{ genre_count|default:"0" }}</span>건의 리뷰</span>
                    </div>
                        </div>
                    </div>
                </div>
                
                <!-- 선택 공연 리뷰 평균 평점 카드 -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm hover-card">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h5 class="card-title fw-bold mb-0 text-gray-800">선택 공연 리뷰 평점</h5>
                    </div>
                    <div class="text-center mb-4">
                        <div class="display-4 fw-bold text-success mb-1">{{ selected_avg|floatformat:1|default:"0.0" }}</div>
                        <div class="text-gray-500 small fw-medium">/10점</div>
                            </div>
                    <div class="progress rounded-pill mb-3" style="height: 8px;">
                                <div class="progress-bar bg-success" role="progressbar" 
                                     style="width: {% widthratio selected_avg|default:0 10 100 %}%;" 
                                     aria-valuenow="{{ selected_avg|floatformat:1|default:'0' }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="10">
                                </div>
                            </div>
                    <div class="d-flex align-items-center justify-content-center">
                        <span class="text-gray-600">공연 <span class="fw-bold text-gray-800">{{ selected_count|default:"0" }}</span>건의 리뷰</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ChatGPT 리뷰 분석 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-4 border-0">
            <h3 class="mb-0 fw-bold">ChatGPT 리뷰 분석</h3>
        </div>
        <div class="card-body p-4">
            <div class="d-flex gap-3 mb-4">
                <button id="positiveSummaryBtn" 
                        class="btn btn-primary rounded-3 d-flex align-items-center gap-2 px-4 py-2"
                        data-url="{% url 'review:summarize_positive_reviews' selected_concert.id %}">
                    긍정 리뷰 분석
                </button>
                <button id="negativeSummaryBtn" 
                        class="btn btn-soft-danger rounded-3 d-flex align-items-center gap-2 px-4 py-2"
                        data-url="{% url 'review:summarize_negative_reviews' selected_concert.id %}">
                    부정 리뷰 분석
                </button>
            </div>
            <!-- 요약 결과를 표시할 컨테이너 -->
            <div id="summaryResults">
                <div id="positiveSummaryContainer" class="mb-3">
                    <!-- 긍정 요약 결과가 여기에 표시됩니다 -->
                </div>
                <div id="negativeSummaryContainer">
                    <!-- 부정 요약 결과가 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 키워드 분석 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-4 border-0">
            <h3 class="mb-0 fw-bold">주요 키워드 분석</h3>
        </div>
        <div class="card-body p-4">
            <div class="row g-4">
                <!-- 전체 키워드 -->
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex align-items-center">
                                <h5 class="mb-0 fw-bold">전체 리뷰 키워드</h5>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            {% if keywords.all %}
                                {% for keyword, score in keywords.all %}
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-gray-700">{{ keyword }}</span>
                                        <span class="badge bg-primary bg-opacity-10 text-primary px-2 py-1">{{ score }}</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted text-center mb-0">키워드 데이터가 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- 긍정 키워드 -->
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex align-items-center">
                                <h5 class="mb-0 fw-bold">긍정 리뷰 키워드</h5>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            {% if keywords.positive %}
                                {% for keyword, score in keywords.positive %}
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-gray-700">{{ keyword }}</span>
                                        <span class="badge bg-success bg-opacity-10 text-success px-2 py-1">{{ score }}</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted text-center mb-0">긍정 키워드 데이터가 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- 부정 키워드 -->
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex align-items-center">
                                <h5 class="mb-0 fw-bold">부정 리뷰 키워드</h5>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            {% if keywords.negative %}
                                {% for keyword, score in keywords.negative %}
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-gray-700">{{ keyword }}</span>
                                        <span class="badge bg-danger bg-opacity-10 text-danger px-2 py-1">{{ score }}</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted text-center mb-0">부정 키워드 데이터가 없습니다.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .summary-content {
            background-color: var(--toss-gray-50);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1rem;
            font-size: 1rem;
            line-height: 1.6;
            color: var(--toss-gray-800);
        }
        
        .summary-content.positive {
            border-left: 4px solid var(--bs-primary);
        }
        
        .summary-content.negative {
            border-left: 4px solid var(--bs-danger);
        }
        
        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }

        .btn-soft-danger {
            color: var(--bs-danger);
            background-color: rgba(220, 53, 69, 0.1);
            border: none;
        }

        .btn-soft-danger:hover {
            color: #fff;
            background-color: var(--bs-danger);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const positiveSummaryBtn = document.getElementById('positiveSummaryBtn');
            const negativeSummaryBtn = document.getElementById('negativeSummaryBtn');
            
            function showLoading(containerId) {
                document.getElementById(containerId).innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                `;
            }
            
            function handleSummaryClick(btn, containerId) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // URL 가져오기
                    const url = btn.dataset.url;
                    if (!url) {
                        console.error('URL이 설정되지 않았습니다.');
                        return;
                    }
                    
                    // 버튼 비활성화 및 로딩 상태 표시
                    btn.disabled = true;
                    const originalContent = btn.innerHTML;
                    btn.innerHTML = `
                        <div class="spinner-border spinner-border-sm me-2" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        분석 중...
                    `;
                    
                    // 로딩 표시
                    showLoading(containerId);
                    
                    fetch(url, {
                        headers: { 'X-Requested-With': 'XMLHttpRequest' }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.text();
                    })
                    .then(html => {
                        const container = document.getElementById(containerId);
                        container.innerHTML = `
                            <div class="summary-content ${containerId.includes('positive') ? 'positive' : 'negative'}">
                                ${html}
                            </div>
                        `;
                    })
                    .catch(error => {
                        document.getElementById(containerId).innerHTML = `
                            <div class="alert alert-danger rounded-3 d-flex align-items-center p-4">
                                <div>
                                    <h6 class="alert-heading mb-1">요약 실패</h6>
                                    <p class="mb-0">요약을 불러오는 중 오류가 발생했습니다. 다시 시도해주세요.</p>
                                </div>
                            </div>
                        `;
                        console.error('Error:', error);
                    })
                    .finally(() => {
                        // 버튼 상태 복구
                        btn.disabled = false;
                        btn.innerHTML = originalContent;
                    });
                });
            }
            
            // 긍정 요약 버튼 이벤트 설정
            handleSummaryClick(positiveSummaryBtn, 'positiveSummaryContainer');
            
            // 부정 요약 버튼 이벤트 설정
            handleSummaryClick(negativeSummaryBtn, 'negativeSummaryContainer');
        });
    </script>

    <!-- 리뷰 추이 분석 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-4 border-0">
            <h3 class="mb-0 fw-bold">리뷰 추이 분석</h3>
        </div>
        <div class="card-body p-4">
            <div class="row g-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="card-title fw-bold mb-0">리뷰 수 추이</h4>
                            </div>
                            <div class="chart-container position-relative" style="height: 300px;">
                                <canvas id="reviewTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="card-title fw-bold mb-0">평균 평점 추이</h4>
                            </div>
                            <div class="chart-container position-relative" style="height: 300px;">
                                <canvas id="ratingTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 차트 공통 옵션
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            padding: 20,
                            font: {
                                size: 12,
                                family: "'Pretendard', sans-serif",
                                weight: 500
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            family: "'Pretendard', sans-serif",
                            weight: 600
                        },
                        bodyFont: {
                            size: 13,
                            family: "'Pretendard', sans-serif"
                        },
                        cornerRadius: 8
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                family: "'Pretendard', sans-serif",
                                size: 12
                            }
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                family: "'Pretendard', sans-serif",
                                size: 12
                            }
                        }
                    }
                }
            };

            // 리뷰 추이 차트
            const dateSummary = {{ selected_date_summary|safe }};
            const reviewLabels = dateSummary.map(item => item.date_str);
            const reviewCounts = dateSummary.map(item => item.reviews_count);
            
            new Chart(document.getElementById("reviewTrendChart"), {
                type: 'line',
                data: {
                    labels: reviewLabels,
                    datasets: [{
                        label: '일별 리뷰 수',
                        data: reviewCounts,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        y: {
                            ...commonOptions.scales.y,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '리뷰 수',
                                font: {
                                    family: "'Pretendard', sans-serif",
                                    size: 13,
                                    weight: 600
                                }
                            }
                        }
                    }
                }
            });

            // 평점 추이 차트
            const ratingSummary = {{ selected_date_rating_summary|safe }};
            const ratingLabels = ratingSummary.map(item => item.date_str);
            const averageRatings = ratingSummary.map(item => item.average_rating);
            
            new Chart(document.getElementById("ratingTrendChart"), {
                type: 'line',
                data: {
                    labels: ratingLabels,
                    datasets: [{
                        label: '일별 평균 평점',
                        data: averageRatings,
                        borderColor: 'rgb(255, 159, 64)',
                        backgroundColor: 'rgba(255, 159, 64, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        ...commonOptions.scales,
                        y: {
                            ...commonOptions.scales.y,
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: '평균 평점',
                                font: {
                                    family: "'Pretendard', sans-serif",
                                    size: 13,
                                    weight: 600
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>

    <!-- 리뷰 분석 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-4 border-0">
            <h3 class="mb-0 fw-bold">리뷰 분석</h3>
        </div>
        <div class="card-body p-4">
            <!-- 감정 분석 -->
                    <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-4">
                    <h5 class="mb-0 fw-bold">감정 분석</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-lg-6 mb-4 mb-lg-0">
                            <div style="height: 300px;">
                                <canvas id="emotionChart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="d-flex flex-column gap-3">
                                <div class="card border-0 bg-primary bg-opacity-10 p-4 rounded-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <span class="fw-bold text-primary">긍정적 리뷰</span>
                                        </div>
                                        <span class="badge bg-primary px-3 py-2 rounded-pill">{{ emotion.positive|default:0 }}개</span>
                                    </div>
                                </div>
                                
                                <div class="card border-0 bg-danger bg-opacity-10 p-4 rounded-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <span class="fw-bold text-danger">부정적 리뷰</span>
                                        </div>
                                        <span class="badge bg-danger px-3 py-2 rounded-pill">{{ emotion.negative|default:0 }}개</span>
                                    </div>
                                </div>
                                
                                <div class="card border-0 bg-secondary bg-opacity-10 p-4 rounded-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <span class="fw-bold text-secondary">중립적 리뷰</span>
                                        </div>
                                        <span class="badge bg-secondary px-3 py-2 rounded-pill">{{ emotion.neutral|default:0 }}개</span>
                    </div>
                </div>

                                <div class="card border-0 bg-dark bg-opacity-10 p-4 rounded-4 mt-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <span class="fw-bold">총 리뷰</span>
                        </div>
                                        <span class="badge bg-dark px-3 py-2 rounded-pill">
                                            {{ emotion.positive|default:0|add:emotion.negative|default:0|add:emotion.neutral|default:0 }}개
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 긍정/부정 리뷰 카드 -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-4 border-0">
            <h3 class="mb-0 fw-bold">리뷰 모음</h3>
        </div>
        <div class="card-body p-4">
            <div class="row g-4">
                <!-- 긍정 리뷰 섹션 -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex align-items-center">
                                <h5 class="mb-0 fw-bold">긍정 리뷰</h5>
                                <span class="badge bg-primary ms-2 px-3 py-2 rounded-pill">{{ positive_reviews|length }}개</span>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="review-container" style="max-height: 600px; overflow-y: auto;">
                                {% if positive_reviews %}
                                    {% for review in positive_reviews %}
                                        <div class="review-card p-4 {% if not forloop.last %}border-bottom{% endif %}">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <div>
                                                    <h6 class="fw-bold mb-2">{{ review.title }}</h6>
                                                    <div class="text-gray-500 small d-flex gap-3">
                                                        <span>{{ review.nickname }}</span>
                                                        <span>{{ review.date }}</span>
                                                    </div>
                                                </div>
                                                <div class="badge bg-primary bg-opacity-10 px-3 py-2 rounded-pill">
                                                    <span class="fw-bold text-primary">{{ review.star_rating }}</span>
                                                </div>
                                            </div>
                                            <p class="mb-0 text-gray-700">{{ review.description }}</p>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="text-center text-gray-500 py-5">
                                        <p class="mb-0">긍정 리뷰가 없습니다.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 부정 리뷰 섹션 -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex align-items-center">
                                <h5 class="mb-0 fw-bold">부정 리뷰</h5>
                                <span class="badge bg-danger ms-2 px-3 py-2 rounded-pill">{{ negative_reviews|length }}개</span>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="review-container" style="max-height: 600px; overflow-y: auto;">
                                {% if negative_reviews %}
                                    {% for review in negative_reviews %}
                                        <div class="review-card p-4 {% if not forloop.last %}border-bottom{% endif %}">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <div>
                                                    <h6 class="fw-bold mb-2">{{ review.title }}</h6>
                                                    <div class="text-gray-500 small d-flex gap-3">
                                                        <span>{{ review.nickname }}</span>
                                                        <span>{{ review.date }}</span>
                                                    </div>
                                                </div>
                                                <div class="badge bg-danger bg-opacity-10 px-3 py-2 rounded-pill">
                                                    <span class="fw-bold text-danger">{{ review.star_rating }}</span>
                                                </div>
                                            </div>
                                            <p class="mb-0 text-gray-700">{{ review.description }}</p>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="text-center text-gray-500 py-5">
                                        <p class="mb-0">부정 리뷰가 없습니다.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 감정 분석 차트
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('emotionChart').getContext('2d');
    new Chart(ctx, {
            type: 'doughnut',
        data: {
                labels: ['긍정', '부정', '중립'],
            datasets: [{
                data: [
                        {{ emotion.positive|default:0 }},
                        {{ emotion.negative|default:0 }},
                        {{ emotion.neutral|default:0 }}
                ],
                backgroundColor: [
                        'rgba(13, 110, 253, 0.8)',  // 긍정 (파란색)
                        'rgba(220, 53, 69, 0.8)',   // 부정 (빨간색)
                        'rgba(108, 117, 125, 0.8)'  // 중립 (회색)
                ],
                borderColor: [
                        'rgba(13, 110, 253, 1)',
                        'rgba(220, 53, 69, 1)',
                        'rgba(108, 117, 125, 1)'
                ],
                    borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                family: "'Pretendard', sans-serif",
                                size: 13
                        }
                    }
                }
            },
                cutout: '60%'
        }
    });
});
</script>
{% endblock %}
